<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet profile</title>
    <link rel="stylesheet" href="pet profile.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <script src="add pet.js"></script>
</head>
<body onload="loadPetData()">

    <!-- Navbar -->
    <header>
        <nav class="navbar">
            <div class="logo">
                <img src="logo.jpg" alt="Aleef Logo">
            </div>
            <ul class="nav-links">
                <li><a href="Home.html">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Service</a></li>
            </ul>
            <div class="nav-icons">
                <a href="user profile.html"><img src="user.svg" alt="User Icon"></a>
                <a href="#"><img src="language.png" alt="Globe Icon"></a>
            </div>
        </nav>
    </header>

    <!-- Main Form Section -->
    <div class="container">
        <h2>Pet's profile</h2>
        <div class="form-container">
            <!-- Left Column -->
            <div class="photo-container">
                <img id="pet-photo" src="pets.png" alt="Pet Photo">
                <input type="file" id="file-input" accept="image/*" onchange="previewImage(event)" disabled />
            </div> 
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" id="name" placeholder="" readonly>
                <span id="name-error" class="error-message"></span>
            </div>

            <div class="form-group">
                <label for="ID">ID</label>
                <input type="text" id="ID" placeholder="" readonly>
                <span id="ID-error" class="error-message"></span>
            </div>

            <div class="form-group">
                <label for="type">Type</label>
                <input type="text" id="type" placeholder="" readonly>
                <span id="type-error" class="error-message"></span>
            </div>

            <div class="form-group">
                <label for="birthday">Birthday</label>
                <input type="date" id="birthday" placeholder="" readonly onchange="calculateAge()">
                <span id="birthday-error" class="error-message"></span>
            </div>

            <!-- Right Column -->
            <div class="form-group">
                <label for="breed">Breed</label>
                <input type="text" id="breed" placeholder="" readonly>
                <span id="breed-error" class="error-message"></span>
            </div>

            <div class="form-group">
                <label for="age">Age</label>
                <input type="text" id="age" placeholder="" disabled>
            </div>

            <div class="form-group">
                <label for="weight">Weight</label>
                <input type="text" id="weight" placeholder="" readonly>
                <span id="weight-error" class="error-message"></span>
            </div>

            <!-- Special Needs Section -->
            <div class="form-group">
                <label>Special Needs</label>
                <div class="toggle-container">
                    <input type="radio" id="special-yes" name="special-needs" disabled>
                    <label for="special-yes">Yes</label>
                    <input type="radio" id="special-no" name="special-needs" disabled>
                    <label for="special-no">No</label>
                </div>
            </div>

            <!-- Spayed/Neutered Section -->
            <div class="form-group">
                <label>Spayed or Neutered</label>
                <div class="toggle-container">
                    <input type="radio" id="spayed-yes" name="spayed-neutered" disabled>
                    <label for="spayed-yes">Yes</label>
                    <input type="radio" id="spayed-no" name="spayed-neutered" disabled>
                    <label for="spayed-no">No</label>
                </div>
            </div>

            <!-- Gender Section -->
            <div class="form-group">
                <label>Gender</label>
                <div class="toggle-container">
                    <input type="radio" id="female" name="gender" disabled>
                    <label for="female">Female</label>
                    <input type="radio" id="male" name="gender" disabled>
                    <label for="male">Male</label>
                </div>
            </div>

            <!-- Training Section -->
            <div class="form-group full-width">
                <label>Training</label>
                <div class="toggle-container">
                    <input type="radio" id="house-trained" name="training" disabled>
                    <label for="house-trained">house-trained</label>
                    
                    <input type="radio" id="crate-trained" name="training" disabled>
                    <label for="crate-trained">crate-trained</label>
                    
                    <input type="radio" id="obedience-level" name="training" disabled>
                    <label for="obedience-level">obedience-level</label>
                </div>
            </div>

            <!-- Vaccination Status Section -->
            <div class="form-group full-width">
                <label>Vaccination Status</label>
                <div class="toggle-container">
                    <input type="radio" id="up-to-date" name="vaccination-status" disabled>
                    <label for="up-to-date">up-to-date</label>
                    
                    <input type="radio" id="overdue" name="vaccination-status" disabled>
                    <label for="overdue">overdue</label>
                    
                    <input type="radio" id="pending" name="vaccination-status" disabled>
                    <label for="pending">pending</label>
                </div>
            </div>

        </div>
        
        <!-- Buttons -->
        <div class="button-group">
            <button class="button edit" type="button" onclick="enableEditing()">Edit</button>
            <button class="button next" type="button" onclick="handleSubmit()">Save</button>
            <button class="button delete" type="button" onclick="deletePetData()">Delete</button>
            <a class="button back" href="pets.html">Back</a>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-links">
                <h4>About Us</h4>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                </ul>
            </div>

            <div class="footer-resources">
                <h4>Resources</h4>
                <ul>
                    <li><a href="#">Tutorials</a></li>
                    <li><a href="#">Blog</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>

            <div class="footer-social">
                <h4>Follow Us</h4>
                <a href="#"><img src="facebook.png" alt="Facebook"></a>
                <a href="#"><img src="instagram.png" alt="Instagram"></a>
                <a href="#"><img src="X.png" alt="Twitter"></a>
            </div>
        </div>

        <div class="footer-bottom">
            <p>Â© 2024 Aleef. All rights reserved.</p>
        </div>
    </footer>

    <script>
               document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const petID = urlParams.get('ID');
            const email = urlParams.get('email');
    
            // Debugging logs
            console.log('Pet ID:', petID);
            console.log('User Email:', email);
    
            if (!petID || !email) {
                alert('Pet ID or User Email is missing.');
                return;
            }
    
            try {
                const response = await fetch(`/pet_data/${email}/${petID}`);
                if (!response.ok) {
                    throw new Error(`Failed to load pet data. Status: ${response.status}`);
                }
    
                const petData = await response.json();
    
                if (!petData) {
                    alert('No data found for this pet ID.');
                    return;
                }
    
                populatePetData(petData);
            } catch (error) {
                alert('Error loading pet data: ' + error.message);
                console.error('Fetch error:', error);
            }
        });
    
        function populatePetData(petData) {
            // Populate fields with pet data
            document.getElementById('pet-photo').src = petData.photo || 'pets.png';
            document.getElementById('name').value = petData.name || 'N/A';
            document.getElementById('ID').value = petData.ID || 'N/A';
            document.getElementById('type').value = petData.type || 'N/A';
            document.getElementById('birthday').value = petData.birthday || '';
            document.getElementById('breed').value = petData.breed || 'N/A';
            document.getElementById('weight').value = petData.weight || 'N/A';
    
            // Set radio buttons
            document.getElementById('special-yes').checked = petData.specialNeeds === "Yes" || petData.specialNeeds === true;
            document.getElementById('special-no').checked = petData.specialNeeds === "No" || petData.specialNeeds === false;
            document.getElementById('spayed-yes').checked = petData.spayedNeutered === "Yes" || petData.spayedNeutered === true;
            document.getElementById('spayed-no').checked = petData.spayedNeutered === "No" || petData.spayedNeutered === false;
            
            if (petData.gender) {
                document.getElementById(petData.gender.toLowerCase()).checked = true;
            }
            
            if (typeof petData.training === 'string') {
                const trainingID = petData.training.toLowerCase().replace(' ', '-');
                const trainingElement = document.getElementById(trainingID);
                if (trainingElement) {
                    trainingElement.checked = true;
                }
            }
    
            if (typeof petData.vaccinationStatus === 'string') {
                const vaccinationID = petData.vaccinationStatus.toLowerCase().replace(' ', '-');
                const vaccinationElement = document.getElementById(vaccinationID);
                if (vaccinationElement) {
                    vaccinationElement.checked = true;
                }
            }
    
            calculateAge();
        }
        function calculateAge() {
            const birthday = new Date(document.getElementById('birthday').value);
            const ageField = document.getElementById('age');
            if (birthday) {
                const today = new Date();
                let age = today.getFullYear() - birthday.getFullYear();
                const monthDiff = today.getMonth() - birthday.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthday.getDate())) {
                    age--;
                }
                ageField.value = age;
            }
        }

        function enableEditing() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => input.removeAttribute('readonly'));
            document.getElementById('file-input').disabled = false; // Enable file input
        }

        async function savePetData() {
            const petData = {
                name: document.getElementById('name').value,
                ID: document.getElementById('ID').value,
                type: document.getElementById('type').value,
                birthday: document.getElementById('birthday').value,
                breed: document.getElementById('breed').value,
                weight: document.getElementById('weight').value,
                specialNeeds: document.getElementById('special-yes').checked ? "Yes" : "No",
                spayedNeutered: document.getElementById('spayed-yes').checked ? "Yes" : "No",
                gender: document.querySelector('input[name="gender"]:checked').id,
                training: document.querySelector('input[name="training"]:checked').id,
                vaccinationStatus: document.querySelector('input[name="vaccination-status"]:checked').id,
            };

            try {
                const response = await fetch(`/pet_data/${petData.ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(petData)
                });
    
                if (response.ok) {
                    alert('Pet data updated successfully!');
                } else {
                    throw new Error('Failed to update pet data');
                }
            } catch (error) {
                console.error('Error updating pet data:', error);
                alert('Error updating pet data.');
            }
        }

        async function deletePetData() {
            const petID = new URLSearchParams(window.location.search).get('ID');
    
            if (confirm('Are you sure you want to delete this pet?')) {
                try {
                    const response = await fetch(`/pet_data/${petID}`, {
                        method: 'DELETE'
                    });
    
                    if (response.ok) {
                        alert('Pet data deleted successfully!');
                        window.location.href = 'user profile.html';
                    } else {
                        throw new Error('Error deleting pet data');
                    }
                } catch (error) {
                    console.error('Error deleting pet data:', error);
                    alert('Error deleting pet data.');
                }
            }
        }

        // Helper function to get cookie by name
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
    </script>
</body>
</html>
